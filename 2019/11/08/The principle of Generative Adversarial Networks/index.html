<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="zhihuaT">





<title>The principle of Generative Adversarial Networks | zhihuaT</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
            <!-- MathJax配置，可通过单美元符号书写行内公式等 -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": {
        preferredFont: "TeX",
        availableFonts: ["STIX","TeX"],
        linebreaks: { automatic:true },
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
        processEscapes: true,
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
        Macros: { href: "{}" }
    },
    messageStyle: "none"
    });
</script>
<!-- 给MathJax元素添加has-jax class -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<!-- 通过连接CDN加载MathJax的js代码 -->
<script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


        
    


<meta name="generator" content="Hexo 4.2.0"></head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">zhihuaT</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>

        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">zhihuaT</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">The principle of Generative Adversarial Networks</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">zhihuaT</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">November 8, 2019&nbsp;&nbsp;10:46:51</a>
                        </span>
                    
                    
                </div>
            
        </header>

        <div class="post-content">
            <p>最近重温了一遍生成式对抗网络的相关知识, 有了一些新的收获. 理解更深刻了, 思路也更清晰了, 在此记录一下. </p>
<a id="more"></a>
<h2 id="Basic-concepts"><a href="#Basic-concepts" class="headerlink" title="Basic concepts"></a>Basic concepts</h2><p>基本概念, 不在过多赘述. 主要就是两个网络之间相互博弈的思想. 但有两点需要思考:</p>
<ol>
<li>生成式对抗网络的提出过程不仅仅是简单的想出让两个网络相互博弈的过程. </li>
<li>生成器和判别器, 为什么最后的结果是生成器达到最强(可以生成以假乱真的图像), 而不是判别器达到最强(可以将真假图像完全区分出来)?</li>
</ol>
<h2 id="Basic-idea-of-GAN"><a href="#Basic-idea-of-GAN" class="headerlink" title="Basic idea of GAN"></a>Basic idea of GAN</h2><p>虽然算法最后生成的是与真实图像几乎没有区别的样本, 但实际上生成器得到的是一个分布 $P<em>{G}(x)$. 我们的目标是想让 $P</em>{G}(x)$ 尽可能的接近数据的真实分布$P_{data}(x)$.</p>
<h3 id="KL-divergence"><a href="#KL-divergence" class="headerlink" title="$KL$ divergence"></a>$KL$ divergence</h3><p>在测度论中, 如果我们想要衡量具有同一随机变量的两个独立的概率分布$P(x)$和$Q(x)$的差异, 我们可以用$KL$散度来进行计算:</p>
<script type="math/tex; mode=display">
D_{KL}(P\parallel Q)=\mathit{E}_{x\backsim P(x)}[log\frac{P(x)}{Q(x)}]=\mathit{E}_{x\backsim P(x)}[log P(x)-log Q(x)]</script><p>$KL$散度有很多有用的性质, 最重要的是它是非负的. $KL$散度为0,  当且仅当$P(x)$和$Q(x)$在离散型变量的情况下是相等的, 或在连续型变量的情况下<strong>几乎处处</strong>相等. </p>
<p>然而, 他有一个缺点那就是非对称的, 这意味着选择$D<em>{KL}(P\parallel Q)$还是$D</em>{KL}(Q\parallel P)$影响很大.</p>
<p>$KL$散度可以由极大似然估计来导出.</p>
<p>给定一个样本数据的分布$P<em>{data}(x)$和生成的数据分布$P</em>{G}(x;\theta)$, 我们希望GAN可以找到一组参数$\theta$, 使分布$P<em>{data}(x)$和$P</em>{G}(x;\theta)$之间的距离最短, 从而生成器可以生成十分逼真的图像.</p>
<p>首先我们从$P<em>{data}(x)$中抽取m个真实样本${x</em>{1},x<em>{2},\dots ,x</em>{m}}$, 可以计算$P<em>{G}(x</em>{i};\theta)$为在由$\theta$生成的分布中, $x_{i}$样本所出现的概率. 因此, 构造似然函数:</p>
<script type="math/tex; mode=display">
L=\prod_{i=1}^{m}P_{G}(x_{i};\theta)</script><p>下面我们最大化似然函数来求得参数$\theta$:</p>
<script type="math/tex; mode=display">
\begin{aligned}
\theta^{*}=& \arg \max\limits_{\theta}\prod_{i=1}^{m}P_{G}(x_{i};\theta)
=\arg\max\limits_{\theta}\log\prod_{i=1}^{m}P_{G}(x_{i};\theta)\\
=&\arg\max\limits_{\theta}\sum_{i=1}^{m}\log\prod_{i=1}^{m}P_{G}(x_{i};\theta)\\
\thickapprox&\arg\max\limits_{\theta}\mathit{E}_{x\backsim P_{data}}\log[P_{G}(x_{i};\theta)]\\ 
=&\arg\max\limits_{\theta}\int_{x}P_{data}(x)\log P_{G}(x;\theta)dx-\int_{x}P_{data}(x)\log P_{data}(x)dx\\
=&\arg\min\limits_{\theta}\int_{x}P_{data}(x)[\log P_{data}(x)-\log P_{G}(x;\theta)]dx\\
=&\arg\min\limits_{\theta}KL(P_{data}(x)\parallel P_{G}(x))
\end{aligned}</script><p>从上式中可以看出, 如果想要找到最优的参数$\theta$, 我们需要找到$P<em>{data}(x)$与$ P</em>{G}(x)$之间的$KL$散度. 但在实际操作中, 这是做不到的. 因为我们即使是真实的分布$ P<em>{data}(x)$也写不出来,跟不用说$ P</em>{G}(x)$.</p>
<h3 id="The-advantage-of-GAN"><a href="#The-advantage-of-GAN" class="headerlink" title="The advantage of GAN"></a>The advantage of GAN</h3><p>既然我们求不出$P<em>{data}(x)$与$ P</em>{G}(x)$之间的$KL$散度, GAN就想出了一个办法来替代这两个分布之间的差异, 那就是引入判别器$Discriminator$. 利用机器学习的思想, 判别器可以一步步的增强, 以更好的对两个分布之中的样本进行区分.</p>
<p>而要想得到一个比较好生成器$G$和判别器$D$, 我们需要对下面这一式子进行优化:</p>
<script type="math/tex; mode=display">
G^{*},D^{*}=\min\limits_{\theta}\max\limits_{\theta}V(G,D)</script><p>首先我们需要定义一个判别器$D$以判别样本是不是从$P_{data}$分布中取出来, 因此有:</p>
<script type="math/tex; mode=display">
\mathit{E}_{x\sim p_{data}(x)}\log(D(x))</script><p>最大化这一项相当于令判别器$D$在$x\sim P_{data}(x)$时可以准确预测出$D(x)=1$.</p>
<p>另一项是企图骗过判别器的生成器$G$. 根据<strong>负类</strong>的对数损失函数构建:</p>
<script type="math/tex; mode=display">
\mathit{E}_{z\sim p(z)}\log(1-D(G(z)))</script><p>最大化这一项, 需要$D(G(x))$尽可能的等于$0$, 因此判别器$D$可以生成的假图像区分出来. 而最小化这一项, $G$就可以骗过判别器达到以假乱真.</p>
<p>结合以上两个概念, 我们可以定义价值函数:</p>
<script type="math/tex; mode=display">
V(G,D):=\mathit{E}_{x\sim p_{data}(x)}\log(D(x))+\mathit{E}_{z\sim p(z)}\log(1-D(G(z)))</script><p>在实际应用中, 我们可以先初始化一个生成器$G$, 找到在此生成器下最好的判别器$D_{G}^{*}$:</p>
<script type="math/tex; mode=display">
D_{G}^{*}=\arg\max V(G,D)</script><p>然后固定$D$, 并最小化$V(G,D)$以得到最优的$G$:</p>
<script type="math/tex; mode=display">
G^{*}=\arg\min V(G,D_{G}^{*})</script><h3 id="Theoretical-Analysis"><a href="#Theoretical-Analysis" class="headerlink" title="Theoretical Analysis"></a>Theoretical Analysis</h3><p>以下, 我们从理论证明, 可以得到最优的判别器和生成器.</p>
<h4 id="Finding-the-Best-Discriminator"><a href="#Finding-the-Best-Discriminator" class="headerlink" title="Finding the Best Discriminator"></a><strong>Finding the Best Discriminator</strong></h4><p>首先,我们先假设已知:</p>
<script type="math/tex; mode=display">
\mathit{E}_{z\sim P(z)}\log(1-D(G(z)))=\mathit{E}_{x\sim p_{G}(x)}\log(1-D(x)</script><p>那么:</p>
<script type="math/tex; mode=display">
V(G,D):=\mathit{E}_{x\sim p_{data}(x)}\log(D(x))+\mathit{E}_{x\sim p_{G}(x)}\log(1-D(x)</script><p>将价值函数展开为积分形式:</p>
<script type="math/tex; mode=display">
V(G,D) =\int_{x }p_{data}(x)\log D(x)-p_{g}(x)\log (1-D(x))dx</script><p>如果我们想要令$V(G,D)$达到做大, 则只需要上他的积分函数达到最大. 即, 找到最优的$D(x)$, 令 $p<em>{data}(x)\log D(x)-p</em>{g}(x)\log (1-D(x))$ 达到最大. </p>
<p>将$D(x)$看做变量, 利用求导求极值的放法,可以求得当:</p>
<script type="math/tex; mode=display">
D^{*}(x)=\frac{P_{data}(x)}{P_{data}(x)+P_{G}(x)}</script><p> 时, $V(G,D)$最大. 且此极大值是唯一的.</p>
<p>在实际计算中, $D(x)$是不可计算的, 因为我们并不知道先验的$P_{data}(x)$, 但在数学上证明了了他的存在. 并且这可以帮我们证明最优$G$也是存在的.</p>
<h4 id="Finding-the-Best-Generator"><a href="#Finding-the-Best-Generator" class="headerlink" title="Finding the Best Generator"></a><strong>Finding the Best Generator</strong></h4><p>GAN的目标是令$P<em>{G}(x)=P</em>{data}(x)$, 当我们将其代入最优$D(x)$的表达式中, 可以得到</p>
<script type="math/tex; mode=display">
D_{G}^{*}=\frac{P_{data}(x)}{P_{data}(x)+P_{G}(x)}=\frac{1}{2}</script><p>即判别样本来自$P<em>{data}(x)$和$P</em>{G}(x)$的概率都为$\frac{1}{2}$, 也就意味这判别器已经完全分不清真假图像了.(前面思考2的原因)</p>
<p>基于这一观点, Ian Goodfellow 证明了$G$就是极大极小博弈的解. 以下我们对其进行证明.</p>
<p>首先我们反向证明, 即已知$P<em>{G}(x)=P</em>{data}(x)$, 来找$C(G)=\max V(G,D)$的全局最小点.此时:</p>
<script type="math/tex; mode=display">
\begin{aligned}
V(G,D_{G}^*) =&\int_{x }p_{data}(x)\log \frac{1}{2}-p_{g}(x)\log (1-\frac{1}{2})dx\\
=&-\log2\int_{x}P_{G}(x)dx-\log2\int_{x}P_{data}(x)dx\\
=&-2\log2\\
=&-\log4
\end{aligned}</script><p>由于只有当$P<em>{G}(x)=P</em>{data}(x)$时该值才会出现, 因此接下来我们从正向证明这个值就是最小值, 也就是满足当且仅当的条件.</p>
<p>放弃$P<em>{G}(x)=P</em>{data}(x)$的假设,对任意一个$G$, 我们将最优$D^{*}(x)$代入$C(G)=\max V(G,D)$中:</p>
<script type="math/tex; mode=display">
\begin{aligned}
C(G)=&\int_{x}p_{data}(x)\log\frac{P_{data}(x)}{P_{data}(x)+P_{G}(x)}\\
+&p_{G}(x)\log\frac{P_{G}(x)}{P_{data}(x)+P_{G}(x)}dx
\end{aligned}</script><p>因为已知$-\log4$为全局最小值, 因此我们希望构造某个值使方程中出现$-\log2$.</p>
<script type="math/tex; mode=display">
\begin{aligned}
C(G)=&\int_{x}(\log2-\log2)p_{data}(x)+p_{data}(x)\log\frac{P_{data}(x)}{P_{data}(x)+P_{G}(x)}\\
+&(\log2-\log2)p_{G}(x)+p_{G}(x)\log\frac{P_{G}(x)}{P_{data}(x)+P_{G}(x)}dx
\end{aligned}</script><p>经过简化后, 可以得到:</p>
<script type="math/tex; mode=display">
\begin{aligned}
C(G)=&-\log2\int_{x}(p_{data}(x)+p_{G}(x))dx\\
+&\int_{x}p_{data}(x)(\log2+\log\frac{P_{data}(x)}{P_{data}(x)+P_{G}(x)})\\
+&p_{G}(x)(\log2+\log\frac{P_{G}(x)}{P_{data}(x)+P_{G}(x)})dx
\end{aligned}</script><p>再经过化简可以得到:</p>
<script type="math/tex; mode=display">
\begin{aligned}
C(G)=&-\log4+\int_{x}p_{data}(x)\log\frac{P_{data}(x)}{(P_{data}(x)+P_{G}(x))/2}\\
+&p_{G}(x)\log\frac{P_{G}(x)}{(P_{data}(x)+P_{G}(x))/2}dx
\end{aligned}</script><p>根据前面$KL$散度的定义, 我们可以发现:</p>
<script type="math/tex; mode=display">
\begin{aligned}
C(G)=-\log4+KL(p_{data}\parallel\frac{p_{data}+p_{G}}{2})+KL(p_{data}\parallel\frac{p_{data}+p_{G}}{2})
\end{aligned}</script><p>$KL$散度是非负的, 因此我们可以得出$-\log4$就是$C(G)$的全局最小值. 接下来即说明$P<em>{G}(x)=P</em>{data}(x)$为唯一的条件. </p>
<p>引入$JS$散度, $JS(P \parallel Q)=\frac{1}{2}KL(P\parallel M)+\frac{1}{2}KL(P\parallel M)$, 其中$M=\frac{1}{2}(P+Q)$. 因此</p>
<script type="math/tex; mode=display">
C(G)=-\log4+2\cdot JS(P_{data} \parallel P_{G})</script><p>$JS$散度的取值为$0$到$\log2$,.若两个分布完全没有交集,那么$JS$散度取最大值$\log2$; 若另个分布完全一样, 那么$JS$散度取值为$0$. 因此只有当$P<em>{G}(x)=P</em>{data}(x)$时, $C(G)$取得最小值$-\log4$.</p>
<p>由此, 最优生成器和判别器的存在性和唯一性得以证明.</p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>zhihuaT</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="http://yoursite.com/2019/11/08/The%20principle%20of%20Generative%20Adversarial%20Networks/">http://yoursite.com/2019/11/08/The%20principle%20of%20Generative%20Adversarial%20Networks/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span>Do you believe in <strong>DESTINY<strong>?</span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"># 深度学习</a>
                    
                        <a href="/tags/%E7%94%9F%E6%88%90%E5%BC%8F%E5%AF%B9%E6%8A%97%E7%BD%91%E7%BB%9C/"># 生成式对抗网络</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
            
            <a class="next" rel="next" href="/2019/07/25/InfoGAN%E8%AE%BA%E6%96%87/">InfoGAN论文</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© zhihuaT | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
